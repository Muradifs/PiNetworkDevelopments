<html>

    <head>
        <script type="text/javascript" src="jquery-3.5.1.min.js"></script>
        <!--<script src="https://downloads.minepi.com/sdk/v1/dev.js"></script>-->
        <!--<script src="https://downloads.minepi.com/sdk/v1/prod.js"></script>-->
        <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    </head>

    <body>

        <input id="pi_donate" name="pi_donate" type="text" />
        <input id="button_click" name="button_click" value="Donate" type="button"/>
        
        <br/><br/>
        <a href="https://github.com/rockcesar/PiNetworkDevelopments/tree/master/PiDevelopment_test1/public">Watch code.</a> 
        URL:<br/>https://github.com/rockcesar/PiNetworkDevelopments/tree/master/PiDevelopment_test1/public

        <script type="text/javascript">
            $( document ).ready(function() {
                const Pi = window.Pi;
                Pi.init({ version: "2.0" });

                //alert(PiNetworkClient);

                async function auth() {
                    try {
                        // Identify the user with their username / unique network-wide ID, and get permission to request payments from them.
                        const scopes = ['username', 'payments'];
                        function onIncompletePaymentFound(payment) { /* ... */ }; // Read more about this in the SDK reference

                        Pi.authenticate(scopes, onIncompletePaymentFound).then(function(auth) {
                          $( "#button_click" ).click(function() {
                                if(parseFloat($("#pi_donate").val()) > 0)
                                {
                                    $("#button_click").prop( "disabled", true );
                                    setTimeout(function ()
                                    {
                                        $("#button_click").prop( "disabled", false );
                                    }, 10000);
                                    transfer();
                                }
                                //alert("Click");
                            });
                            //alert('Hello ' + auth.user.username);
                        }).catch(function(error) {
                          console.error(error);
                        });
                    } catch (err) {
                        alert(err);
                        // Not able to fetch the user
                    }
                }

                async function transfer() {
                    try {
                        const payment = Pi.createPayment({
                          // Amount of Ï€ to be paid:
                          amount: parseFloat($("#pi_donate").val()),
                          // An explanation of the payment - will be shown to the user:
                          memo: "Demo transfer request", // e.g: "Digital kitten #1234",
                          // An arbitrary developer-provided metadata object - for your own usage:
                          metadata: { /* ... */ }, // e.g: { kittenId: 1234 }
                        }, {
                          // Callbacks you need to implement - read more about those in the detailed docs linked below:
                          onReadyForServerApproval: function(paymentId) { $("#button_click").prop( "disabled", false ); /* ... */ },
                          onReadyForServerCompletion: function(paymentId, txid) { 
                              $("#button_click").prop( "disabled", false );
                          },
                          onCancel: function(paymentId) { $("#button_click").prop( "disabled", false ); /* ... */ },
                          onError: function(error, payment) { $("#button_click").prop( "disabled", false ); /* ... */ },
                        });
                    } catch(err) {
                        $("#button_click").prop( "disabled", false );
                        alert(err);
                        // Technical problem (eg network failure). Please try again
                    }
                }

                auth();

            });
        </script>

    </body>

</html>
